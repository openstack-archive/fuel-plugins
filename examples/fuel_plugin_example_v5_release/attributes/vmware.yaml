editable:
  metadata:
    -
      name: "availability_zones"
      type: "array"
      restrictions:
        - condition: "settings:common.use_vcenter.value == false"
          message: "VMware vCenter not enabled for cluster"
      fields:
        -
          name: "az_name"
          type: "text"
          label: "Availability zone"
          description: "Availability zone name"
          regex:
            source: &availability_zone_blacklist '^(?!nova$)\w+$'
            error: "Invalid availability zone name"
        -
          name: "vcenter_host"
          type: "text"
          label: "vCenter host"
          description: "vCenter host or IP"
          regex:
            source: &ipv4_or_hostname_regex '^[a-zA-Z\d]+[-\.\da-zA-Z]*$'
            error: "Invalid vCenter host"
        -
          name: "vcenter_username"
          type: "text"
          label: "vCenter username"
          description: "vCenter username"
          regex:
            source: &non_empty_string '\S'
            error: "Empty vCenter username"
        -
          name: "vcenter_password"
          type: "password"
          label: "vCenter password"
          description: "vCenter password"
          regex:
            source: *non_empty_string
            error: "Empty vCenter password"
        -
          name: "vcenter_insecure"
          type: "checkbox"
          label: "Bypass vCenter certificate verification"
        -
          name: "vc_ca_file"
          type: "file"
          label: "CA file"
          description: "File containing the trusted CA bundle that emitted vCenter server certificate. Even if CA bundle is not uploaded, certificate verification is turned on."
        -
          name: "nova_computes"
          type: "array"
          editable_for_deployed: true
          fields:
            -
              name: "vsphere_cluster"
              type: "text"
              label: "vSphere cluster"
              description: "vSphere cluster"
              regex:
                source: *non_empty_string
                error: "Invalid vSphere cluster"
            -
              name: "service_name"
              type: "text"
              label: "Service name"
              description: "Service name"
              regex:
                source: '^\w[\w\-]+$'
                error: "Invalid service name"
            -
              name: "datastore_regex"
              type: "text"
              label: "Datastore regex"
              description: "Datastore regex"
              regex:
                source: *non_empty_string
                error: "Invalid datastore regex"
            -
              name: "target_node"
              type: "select"
              label: "Target node"
              description: "Target node for nova-compute service"
    -
      name: "glance"
      type: "object"
      restrictions:
        - condition: "settings:storage.images_vcenter.value == false or settings:common.use_vcenter.value == false"
          message: "VMware vCenter datastore for images is not enabled in Settings tab"
      fields:
        -
          name: "vcenter_host"
          type: "text"
          label: "vCenter host"
          description: "vCenter host or IP"
          regex:
            source: *ipv4_or_hostname_regex
            error: "Invalid vCenter host"
        -
          name: "vcenter_username"
          type: "text"
          label: "vCenter username"
          description: "vCenter username"
          regex:
            source: *non_empty_string
            error: "Empty vCenter username"
        -
          name: "vcenter_password"
          type: "password"
          label: "vCenter password"
          description: "vCenter password"
          regex:
            source: *non_empty_string
            error: "Empty vCenter password"
        -
          name: "datacenter"
          type: "text"
          label: "Datacenter"
          description: "Datacenter"
          regex:
            source: *non_empty_string
            error: "Invalid datacenter"
        -
          name: "datastore"
          type: "text"
          label: "Datastore"
          description: "Datastore"
          regex:
            source: *non_empty_string
            error: "Invalid datastore"
        -
          name: "vcenter_insecure"
          type: "checkbox"
          label: "Bypass vCenter certificate verification"
        -
          name: "ca_file"
          type: "file"
          label: "CA file"
          description: "File containing the trusted CA bundle that emitted vCenter server certificate. Even if CA bundle is not uploaded, certificate verification is turned on."
  value:
    availability_zones:
      -
        az_name: "vcenter"
        vcenter_host: ""
        vcenter_username: ""
        vcenter_password: ""
        vcenter_insecure: true
        vc_ca_file: {}
        nova_computes:
          -
            vsphere_cluster: ""
            service_name: ""
            datastore_regex: ""
            target_node:
              options:
                - id: "controllers"
                  label: "controllers"
              current:
                id: "controllers"
                label: "controllers"
    glance:
      vcenter_host: ""
      vcenter_username: ""
      vcenter_password: ""
      datacenter: ""
      datastore: ""
      vcenter_insecure: true
      ca_file: {}