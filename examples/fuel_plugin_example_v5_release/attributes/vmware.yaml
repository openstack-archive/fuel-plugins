editable:
  kernel_params:
    kernel:
      value: "console=tty0 net.ifnames=1 biosdevname=0 rootdelay=90 nomodeset"
  repo_setup:
    metadata:
      label: "Repositories"
      weight: 50
      group: "general"
      always_editable: true
    repos:
      type: "custom_repo_configuration"
      extra_priority: null
      description: |
        Please note: the first repository will be considered the operating system mirror that will be used during node provisioning.
        To create a local repository mirror on the Fuel master node, please follow the instructions provided by running "fuel-createmirror --help" on the Fuel master node.
        Please make sure your Fuel master node has Internet access to the repository before attempting to create a mirror.
      value:
        - type: "deb"
          name: "ubuntu"
          uri: "http://archive.ubuntu.com/ubuntu/"
          suite: "xenial"
          section: "main universe multiverse"
          priority: null
        - type: "deb"
          name: "ubuntu-updates"
          uri: "http://archive.ubuntu.com/ubuntu/"
          suite: "xenial-updates"
          section: "main universe multiverse"
          priority: null
        - type: "deb"
          name: "ubuntu-security"
          uri: "http://archive.ubuntu.com/ubuntu/"
          suite: "xenial-security"
          section: "main universe multiverse"
          priority: null
        - type: "deb"
          name: "mos"
          uri: "http://{settings.MASTER_IP}:8080/{cluster.release.version}/ubuntu/x86_64"
          suite: "mos10.0"
          section: "main restricted"
          priority: 1050
        - type: "deb"
          name: "mos-updates"
          uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
          suite: "mos10.0-updates"
          section: "main restricted"
          priority: 1050
        - type: "deb"
          name: "mos-security"
          uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
          suite: "mos10.0-security"
          section: "main restricted"
          priority: 1050
        - type: "deb"
          name: "mos-holdback"
          uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
          suite: "mos10.0-holdback"
          section: "main restricted"
          priority: 1100
        - type: "deb"
          name: "Auxiliary"
          uri: "http://{settings.MASTER_IP}:8080/{cluster.release.version}/ubuntu/auxiliary"
          suite: "auxiliary"
          section: "main restricted"
          priority: 1150
  provision:
    metadata:
      label: "Provision"
      weight: 80
      group: "general"
      restrictions:
        - condition: "false"
          action: "hide"
    packages:
      label: "Initial packages"
      weight: 10
      type: "textarea"
      value: |
        acl
        anacron
        bash-completion
        bridge-utils
        bsdmainutils
        build-essential
        cloud-init
        curl
        daemonize
        debconf-utils
        gdisk
        grub-pc
        hwloc
        linux-firmware
        linux-headers-generic-lts-xenial
        linux-image-generic-lts-xenial
        lvm2
        mcollective
        mdadm
        multipath-tools
        multipath-tools-boot
        nailgun-agent
        nailgun-mcagents
        network-checker
        ntp
        ntpdate
        openssh-client
        openssh-server
        puppet
        python-amqp
        ruby-augeas
        ruby-ipaddress
        ruby-json
        ruby-netaddr
        ruby-openstack
        ruby-shadow
        ruby-stomp
        telnet
        ubuntu-minimal
        ubuntu-standard
        uuid-runtime
        vim
        virt-what
        vlan
  metadata:
    -
      name: "availability_zones"
      type: "array"
      restrictions:
        - condition: "settings:common.use_vcenter.value == false"
          message: "VMware vCenter not enabled for cluster"
      fields:
        -
          name: "az_name"
          type: "text"
          label: "Availability zone"
          description: "Availability zone name"
          regex:
            source: &availability_zone_blacklist '^(?!nova$)\w+$'
            error: "Invalid availability zone name"
        -
          name: "vcenter_host"
          type: "text"
          label: "vCenter host"
          description: "vCenter host or IP"
          regex:
            source: '^[a-zA-Z\d]+[-\.\da-zA-Z]*$'
            error: "Invalid vCenter host"
        -
          name: "vcenter_username"
          type: "text"
          label: "vCenter username"
          description: "vCenter username"
          regex:
            source: &non_empty_string '\S'
            error: "Empty vCenter username"
        -
          name: "vcenter_password"
          type: "password"
          label: "vCenter password"
          description: "vCenter password"
          regex:
            source: *non_empty_string
            error: "Empty vCenter password"
        -
          name: "vcenter_insecure"
          type: "checkbox"
          label: "Bypass vCenter certificate verification"
        -
          name: "vc_ca_file"
          type: "file"
          label: "CA file"
          description: "File containing the trusted CA bundle that emitted vCenter server certificate. Even if CA bundle is not uploaded, certificate verification is turned on."
        -
          name: "nova_computes"
          type: "array"
          editable_for_deployed: true
          fields:
            -
              name: "vsphere_cluster"
              type: "text"
              label: "vSphere cluster"
              description: "vSphere cluster"
              regex:
                source: *non_empty_string
                error: "Invalid vSphere cluster"
            -
              name: "service_name"
              type: "text"
              label: "Service name"
              description: "Service name"
              regex:
                source: '^\w[\w\-]+$'
                error: "Invalid service name"
            -
              name: "datastore_regex"
              type: "text"
              label: "Datastore regex"
              description: "Datastore regex"
              regex:
                source: *non_empty_string
                error: "Invalid datastore regex"
            -
              name: "target_node"
              type: "select"
              label: "Target node"
              description: "Target node for nova-compute service"
    -
      name: "glance"
      type: "object"
      restrictions:
        - condition: "settings:storage.images_vcenter.value == false or settings:common.use_vcenter.value == false"
          message: "VMware vCenter datastore for images is not enabled in Settings tab"
      fields:
        -
          name: "vcenter_host"
          type: "text"
          label: "vCenter host"
          description: "vCenter host or IP"
          regex:
            source: '^[a-zA-Z\d]+[-\.\da-zA-Z]*$'
            error: "Invalid vCenter host"
        -
          name: "vcenter_username"
          type: "text"
          label: "vCenter username"
          description: "vCenter username"
          regex:
            source: *non_empty_string
            error: "Empty vCenter username"
        -
          name: "vcenter_password"
          type: "password"
          label: "vCenter password"
          description: "vCenter password"
          regex:
            source: *non_empty_string
            error: "Empty vCenter password"
        -
          name: "datacenter"
          type: "text"
          label: "Datacenter"
          description: "Datacenter"
          regex:
            source: *non_empty_string
            error: "Invalid datacenter"
        -
          name: "datastore"
          type: "text"
          label: "Datastore"
          description: "Datastore"
          regex:
            source: *non_empty_string
            error: "Invalid datastore"
        -
          name: "vcenter_insecure"
          type: "checkbox"
          label: "Bypass vCenter certificate verification"
        -
          name: "ca_file"
          type: "file"
          label: "CA file"
          description: "File containing the trusted CA bundle that emitted vCenter server certificate. Even if CA bundle is not uploaded, certificate verification is turned on."
  value:
    availability_zones:
      -
        az_name: "vcenter"
        vcenter_host: ""
        vcenter_username: ""
        vcenter_password: ""
        vcenter_insecure: true
        vc_ca_file: {}
        nova_computes:
          -
            vsphere_cluster: ""
            service_name: ""
            datastore_regex: ""
            target_node:
              options:
                - id: "controllers"
                  label: "controllers"
              current:
                id: "controllers"
                label: "controllers"
    glance:
      vcenter_host: ""
      vcenter_username: ""
      vcenter_password: ""
      datacenter: ""
      datastore: ""
      vcenter_insecure: true
      ca_file: {}